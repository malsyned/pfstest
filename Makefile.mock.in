# -*- Makefile -*-

MOCK_CPPFLAGS := -D"__attribute__(x)=" \
                 -D"__asm__(x)=" \
                 -D"__extension__="

AUTOMOCK_ARGS := -t __builtin_va_list \
                 -f __inline \
                 -f __inline__ \
                 -q __const \
                 -q __restrict

tests/mock-%.c tests/mock-%.h: tests/%.h $(MAKEFILE_LIST)
	$(CC) -E $(all-cppflags) $(MOCK_CPPFLAGS) -o - $< \
	  | automock/automock.py $(AUTOMOCK_ARGS) $< $(basename $@)
