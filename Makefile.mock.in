# -*- Makefile -*-

MOCK_CPPFLAGS := -D"__attribute__(x)=" \
                 -D"__asm__(x)=" \
                 -D__extension__= \
                 -D__restrict=restrict \
                 -D__inline=inline \
                 -D__builtin_va_list="void *"

tests/mock-%.c tests/mock-%.h: tests/%.h $(MAKEFILE_LIST)
	$(CC) -E $(CPPFLAGS) $(MOCK_CPPFLAGS) -o - $< \
	  | automock/automock.py $< $(basename $@)
