<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>PFSTest: Quickstart</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PFSTest
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">index</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Quickstart </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#intro">Introduction</a></li>
<li class="level1"><a href="#exe">Building a command-line program that runs tests</a></li>
<li class="level1"><a href="#fail">Causing a test to fail</a></li>
<li class="level1"><a href="#cut">Test-driving the development of a simple module</a></li>
<li class="level1"><a href="#assert">Using Matchers and Assertions</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>While PFSTest is designed to be usable even on small embedded devices with limited or unusual IO capabilities, the quickest way to get started developing tests with PFSTest is natively on your development PC.</p>
<p>PFSTest is designed to be modular and flexible, so you have some choices in what C files to include in your project. This guide will walk you through typical choices. The full documentation will explain which parts can be removed for a smaller footprint, and how to enable additional optional features.</p>
<h1><a class="anchor" id="exe"></a>
Building a command-line program that runs tests</h1>
<p>We will start by creating an executable meant to be run on the command-line which will execute our tests and report their results.</p>
<ol type="1">
<li>Start a new C executable project in your favorite IDE or with a Makefile.</li>
<li>From the PFSTest <code>src</code> directory, add the following files:<ul>
<li>All C files in <a class="el" href="dir_aebb8dcc11953d78e620bbef0b9e2183.html">src/core</a></li>
<li>All C files in <a class="el" href="dir_a8ae9ed3edbd0d30a1fa125130f72500.html">src/reporters</a></li>
<li>All C files in <a class="el" href="dir_b78fdfbbb632ce54d070469d6a721373.html">src/cli</a></li>
<li><code>src/alloc/pfstest-alloc-malloc.c</code> </li>
<li><code>src/main/main.c</code> </li>
</ul>
</li>
<li><p class="startli">Add a new C file to your project: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;pfstest.h&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="pfstest-core_8h.html#af04af1bc6d042a68a2b24d6e1312d253">test</a>(first_test)</div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> register_tests(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="pfstest-core_8h.html#a85b755bc213bed274bbad5faaecac865">register_test</a>(first_test);</div><div class="line">}</div></div><!-- fragment --><p class="startli">This test does nothing, and so will pass by default.</p>
<dl class="section note"><dt>Note</dt><dd>register_tests() is called by the main() function defined in <code>src/main/main.c</code> before it invokes PFSTest's command line driver, <a class="el" href="pfstest-cli_8h.html#a05c254744acd3fba43535a254eb1eb81" title="Command-line driver to start the PFSTest harness and cause all registered tests to run...">pfstest_main()</a>.</dd>
<dd>
If you are compiling with GCC or Microsoft Visual C++, you can leave out the definition of register_tests(). PFSTest will detect these compilers and use language extensions to automatically run any test created with <a class="el" href="pfstest-core_8h.html#af04af1bc6d042a68a2b24d6e1312d253" title="Disable by defining PFSTEST_NOALIAS_test. ">test()</a>.</dd></dl>
</li>
<li>Compile and link your program.</li>
<li><p class="startli">Run the program in a terminal. You should see output like this: </p><div class="fragment"><div class="line">PFSTest 0.2</div><div class="line">===========</div><div class="line">.</div><div class="line">Run complete. 1 passed, 0 failed, 0 ignored</div></div><!-- fragment --><p class="startli">Congratulations! You have compiled and run your first test.</p>
</li>
<li><p class="startli">To get more detail about what was done, run your program with the <code>-v</code> flag: </p><div class="fragment"><div class="line">PFSTest 0.2</div><div class="line">===========</div><div class="line">quickstart.c:first_test PASS</div><div class="line"></div><div class="line">Run complete. 1 passed, 0 failed, 0 ignored</div></div><!-- fragment --><p class="startli">From this we can see that one test named "first_test" was run, and that it passed.</p>
<dl class="section note"><dt>Note</dt><dd>If your terminal supports ANSI color escapes, and you want PASS/FAIL results to be highlighted with color, pass the <code>-c</code> flag to your program. <code>-c</code> can be combined with <code>-v</code> or used by itself.</dd></dl>
</li>
</ol>
<h1><a class="anchor" id="fail"></a>
Causing a test to fail</h1>
<p>The most basic way to cause a test to fail is by calling <a class="el" href="pfstest-core_8h.html#a20b7be2029dc5488a8fba5d405b737d8" title="Disable by defining PFSTEST_NOALIAS_fail. ">fail()</a>.</p>
<ol type="1">
<li><p class="startli">In the body of <a class="el" href="pfstest-core_8h.html#af04af1bc6d042a68a2b24d6e1312d253" title="Disable by defining PFSTEST_NOALIAS_test. ">test(first_test)</a>, add this line:  <div class="fragment"><div class="line">    <a class="code" href="pfstest-core_8h.html#a20b7be2029dc5488a8fba5d405b737d8">fail</a>(<span class="stringliteral">&quot;Intentional failure&quot;</span>);</div></div><!-- fragment --></p>
<dl class="section note"><dt>Note</dt><dd>In order to get an example up and running quickly, and to demonstrate PFSTest's core features, we will use <a class="el" href="pfstest-core_8h.html#a20b7be2029dc5488a8fba5d405b737d8" title="Disable by defining PFSTEST_NOALIAS_fail. ">fail()</a> for the first few examples. In real world situations you will probably rarely call <a class="el" href="pfstest-core_8h.html#a20b7be2029dc5488a8fba5d405b737d8" title="Disable by defining PFSTEST_NOALIAS_fail. ">fail()</a> directly, as PFSTest offers a collection of more expressive assertion and matching tools.</dd></dl>
</li>
<li>Rebuild and run. Now your program should produce output like this: <div class="fragment"><div class="line">PFSTest 0.2</div><div class="line">===========</div><div class="line">quickstart.c:first_test FAIL</div><div class="line">    Location: quickstart.c:5</div><div class="line">    Intentional failure</div><div class="line"></div><div class="line">Run complete. 0 passed, 1 failed, 0 ignored</div></div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="cut"></a>
Test-driving the development of a simple module</h1>
<p>We will use test-driven development to develop a simple code module.</p>
<ol type="1">
<li>Delete the <code>first_test</code> block and the <code><a class="el" href="pfstest-core_8h.html#a85b755bc213bed274bbad5faaecac865" title="Disable by defining PFSTEST_NOALIAS_register_test. ">register_test(first_test)</a></code> call from register_tests().</li>
<li>Include a header file for the new module and write a short test to verify its functionality: <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;pfstest.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;square.h&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="pfstest-core_8h.html#af04af1bc6d042a68a2b24d6e1312d253">test</a>(should_square_numbers)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (square(5) != 25) {</div><div class="line">        <a class="code" href="pfstest-core_8h.html#a20b7be2029dc5488a8fba5d405b737d8">fail</a>(<span class="stringliteral">&quot;square(5) didn&#39;t equal 25&quot;</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> register_tests(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="pfstest-core_8h.html#a85b755bc213bed274bbad5faaecac865">register_test</a>(should_square_numbers);</div><div class="line">}</div></div><!-- fragment --></li>
<li>Attempt to build this program. You should get an error like "square.h: No such file or directory". This is the first test error that we're going to use to drive development.</li>
<li>Create a header file, <code>square.h</code>, empty except for a standard header guard:  <div class="fragment"><div class="line"><span class="preprocessor">#ifndef SQUARE_H</span></div><div class="line"><span class="preprocessor">#define SQUARE_H</span></div><div class="line"><span class="preprocessor">#endif </span><span class="comment">/* !SQUARE_H */</span><span class="preprocessor"></span></div></div><!-- fragment --></li>
<li>Attempt to build again. Now you should get a link error about an undefined reference to <code>`square'</code>. You may also get a warning about an implicit declaration of function <code>`square'</code>.</li>
<li><p class="startli">Let's fix those errors:</p>
<p class="startli">In <code>square.h</code>, add  <div class="fragment"><div class="line"><span class="keywordtype">int</span> square(<span class="keywordtype">int</span> x);</div></div><!-- fragment --> between the guard macros. Then create a new C file in your project, <code>square.c</code> and add an empty square() definition: </p><div class="fragment"><div class="line"><span class="keywordtype">int</span> square(<span class="keywordtype">int</span> x)</div><div class="line">{</div><div class="line">}</div></div><!-- fragment --></li>
<li>Try building now. Building should succeed, possibly with a warning about a missing return value. Now, run your test binary, and you should see this output: <div class="fragment"><div class="line">PFSTest 0.2</div><div class="line">===========</div><div class="line">quickstart.c:should_square_numbers FAIL</div><div class="line">    Location: quickstart.c:7</div><div class="line">    square(5) didn&#39;t equal 25</div><div class="line"></div><div class="line">Run complete. 0 passed, 1 failed, 0 ignored</div></div><!-- fragment --></li>
<li>Having seen that test fail, we can now write the code for it to pass: <div class="fragment"><div class="line"><span class="keywordtype">int</span> square(<span class="keywordtype">int</span> x)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> x * x;</div><div class="line">}</div></div><!-- fragment --></li>
<li><p class="startli">Build and run again, and you should no longer see a test failure reported. </p><div class="fragment"><div class="line">PFSTest 0.2</div><div class="line">===========</div><div class="line">quickstart.c:should_square_numbers PASS</div><div class="line"></div><div class="line">Run complete. 1 passed, 0 failed, 0 ignored</div></div><!-- fragment --><p> Congratulations, you've just test-driven the development of your first bit of code with PFSTest!</p>
<dl class="section note"><dt>Note</dt><dd>This example was run with <code>-v</code> to make changed test result more obvious.</dd></dl>
</li>
</ol>
<h1><a class="anchor" id="assert"></a>
Using Matchers and Assertions</h1>
<p><a class="el" href="pfstest-core_8h.html#a20b7be2029dc5488a8fba5d405b737d8" title="Disable by defining PFSTEST_NOALIAS_fail. ">fail()</a> provided a quick way to get started, but most real tests in PFSTest will be written using the Hamcrest-inspired assert_that and matchers. We'll start with a simple example and then explain the new operations it uses.</p>
<ol type="1">
<li><p class="startli">Add a test for a function that cubes its argument: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;pfstest.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;square.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;cube.h&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="pfstest-core_8h.html#af04af1bc6d042a68a2b24d6e1312d253">test</a>(should_square_numbers)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (square(5) != 25) {</div><div class="line">        <a class="code" href="pfstest-core_8h.html#a20b7be2029dc5488a8fba5d405b737d8">fail</a>(<span class="stringliteral">&quot;square(5) didn&#39;t equal 25&quot;</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="pfstest-core_8h.html#af04af1bc6d042a68a2b24d6e1312d253">test</a>(should_cube_numbers)</div><div class="line">{</div><div class="line">    <a class="code" href="pfstest-assert_8h.html#af71007a439b3132f6df14f88d5fce4a0">assert_that</a>(<span class="stringliteral">&quot;5 cubed is 125&quot;</span>, <a class="code" href="pfstest-values_8h.html#a7c4bd1edebf583a1659b6e49e44f5ecf">the_int</a>(cube(5)), <a class="code" href="pfstest-matchers_8h.html#a84cbf211b5b9120d1abf354112d1565d">equal_to</a>(<a class="code" href="pfstest-values_8h.html#a7c4bd1edebf583a1659b6e49e44f5ecf">the_int</a>(125)));</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> register_tests(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <a class="code" href="pfstest-core_8h.html#a85b755bc213bed274bbad5faaecac865">register_test</a>(should_square_numbers);</div><div class="line">    <a class="code" href="pfstest-core_8h.html#a85b755bc213bed274bbad5faaecac865">register_test</a>(should_cube_numbers);</div><div class="line">}</div></div><!-- fragment --><p class="startli"><code>should_cube_numbers</code> contains three new PFSTest features:</p><ul>
<li><p class="startli"><a class="el" href="pfstest-assert_8h.html#af71007a439b3132f6df14f88d5fce4a0" title="Disable by defining PFSTEST_NOALIAS_assert_that. ">assert_that(description, actual_value, matcher)</a></p>
<p class="startli">Most PFSTest tests will use <a class="el" href="pfstest-assert_8h.html#af71007a439b3132f6df14f88d5fce4a0" title="Disable by defining PFSTEST_NOALIAS_assert_that. ">assert_that()</a>. It simplifies and makes more regular the process of writing assertions and printing information about failures. The first argument is a description, which can be an empty string. If provided, it will be printed in failure messages along with the details of the test expectation and the actual value. The second argument is the value returned by the code under test, boxed so that it can be handled generically. The third argument is a matcher that describes the expected value. In this example, <a class="el" href="pfstest-matchers_8h.html#a84cbf211b5b9120d1abf354112d1565d" title="Disable by defining PFSTEST_NOALIAS_equal_to. ">equal_to()</a> is used to create a matcher.</p>
</li>
<li><p class="startli"><a class="el" href="pfstest-values_8h.html#a7c4bd1edebf583a1659b6e49e44f5ecf" title="Disable by defining PFSTEST_NOALIAS_the_int. ">the_int()</a></p>
<p class="startli">In the object-oriented languages where frameworks like xUnit and Hamcrest were initially developed, all types either inherit from a common <code>Object</code> class or can be encapsulated into an object which does. Since C lacks such a common ancestor type, all C primitive values must be passed to a value boxer like <a class="el" href="pfstest-values_8h.html#a7c4bd1edebf583a1659b6e49e44f5ecf" title="Disable by defining PFSTEST_NOALIAS_the_int. ">the_int()</a> before being passed to PFSTest calls like <a class="el" href="pfstest-assert_8h.html#af71007a439b3132f6df14f88d5fce4a0" title="Disable by defining PFSTEST_NOALIAS_assert_that. ">assert_that()</a>, <a class="el" href="pfstest-matchers_8h.html#a84cbf211b5b9120d1abf354112d1565d" title="Disable by defining PFSTEST_NOALIAS_equal_to. ">equal_to()</a>, or <a class="el" href="pfstest-mock_8h.html#a9287d130fa7d2e676e9640db721a1d50" title="Disable by defining PFSTEST_NOALIAS_when. ">when()</a>. Value boxers return a <code>pfstest_value*</code> which keeps track of the size of the data and knows how to print it in messages. For more examples of value boxers, see <a class="el" href="pfstest-values_8h.html">include/pfstest-values.h</a> and <a class="el" href="pfstest-fp_8h.html">include/pfstest-fp.h</a>.</p>
</li>
<li><p class="startli"><a class="el" href="pfstest-matchers_8h.html#a84cbf211b5b9120d1abf354112d1565d" title="Disable by defining PFSTEST_NOALIAS_equal_to. ">equal_to()</a></p>
<p class="startli">Matchers are a flexible, composable means of describing what values produced by the code under test are acceptable. <a class="el" href="pfstest-matchers_8h.html#a84cbf211b5b9120d1abf354112d1565d" title="Disable by defining PFSTEST_NOALIAS_equal_to. ">equal_to()</a> returns a matcher which compares boxed data using memcmp() and boxed pointers with <code>==</code>. For more examples of matchers, see <a class="el" href="pfstest-matchers_8h.html">include/pfstest-matchers.h</a>.</p>
</li>
</ul>
</li>
<li>Create a <code>cube.c</code> / <code>cube.h</code> pair, and add an incorrect implementation of <code>`cube'</code>, to get past compilation and linking errors. <div class="fragment"><div class="line"><span class="keywordtype">int</span> cube(<span class="keywordtype">int</span> n)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --></li>
<li><p class="startli">Run the test runner and see the result of the output of the assertion failure: </p><div class="fragment"><div class="line">PFSTest 0.2</div><div class="line">===========</div><div class="line">.</div><div class="line">quickstart.c:should_cube_numbers FAIL</div><div class="line">    Location: quickstart.c:14</div><div class="line">    Failed assertion: 5 cubed <a class="code" href="pfstest-matchers_8h.html#a9870e0caa2f8e3e5700c4cbb21d73c07">is</a> 125</div><div class="line">    Expected: the <span class="keywordtype">int</span> 125</div><div class="line">    Actual:   the <span class="keywordtype">int</span> 0</div><div class="line"></div><div class="line">Run complete. 1 passed, 1 failed, 0 ignored</div></div><!-- fragment --><p class="startli">Notice that in addition to the file and line number of the failing assertion, PFSTest prints the descriptive text that was passed to it, and a helpful description both of what was expected and what value was actually produced.</p>
</li>
<li>Add working code to <code>`cube'</code>: <div class="fragment"><div class="line"><span class="keywordtype">int</span> cube(<span class="keywordtype">int</span> n)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> n * n * n;</div><div class="line">}</div></div><!-- fragment --></li>
<li>Watch the tests pass: <div class="fragment"><div class="line">PFSTest 0.2</div><div class="line">===========</div><div class="line">..</div><div class="line">Run complete. 2 passed, 0 failed, 0 ignored</div></div><!-- fragment --> </li>
</ol>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
